#! /bin/bash
#
# Used to record the current state of the working directory without reverting it. This is effectively a shortcut to
# `git stash save` <message> followed by `git stash apply`.
#

. git-commands-utils

function create_snapshot
{
    local message="$1"

    if [[ -z "$message" ]]; then
        git stash save -u
    else
        git stash save -u "$message"
    fi
    git stash apply --quiet > /dev/null 2>&1 # apply won't shut up so swallow the output
}

while getopts ":h-:" opt; do
    case $opt in
        -)
            case "${OPTARG}" in
                help)   show_help;;
                *)      error "Unimplemented option --${OPTARG}";;
            esac
            ;;
        h)  show_help;;
        \?) error "Invalid option: -$OPTARG";;
        :)  error "Option -$OPTARG requires an argument.";;
        *)  error "Unimplemented option: -$OPTARG";;
    esac
done

create_snapshot "$@"

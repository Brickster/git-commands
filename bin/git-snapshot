#! /bin/bash
#
# Used to record the current state of the working directory without reverting it. This is effectively a shortcut to
# `git stash save` <message> followed by `git stash apply`.
#

readonly VERSION="0.1.0"

. git-commands-utils

function create_snapshot
{
    local message="$1"

    if [[ -z "$message" ]]; then
        git stash save -u --quiet
    else
        git stash save -u --quiet "$message"
    fi
    git stash apply --quiet
}

while getopts ":hv-:" opt; do
    case $opt in
        -)
            case "${OPTARG}" in
                help)       show_help;;
                version)    show_version "$VERSION";;
                *)      error "Unimplemented option --${OPTARG}";;
            esac
            ;;
        h)  show_help;;
        v)  show_version "$VERSION";;
        \?) error "Invalid option: -$OPTARG";;
        :)  error "Option -$OPTARG requires an argument.";;
        *)  error "Unimplemented option: -$OPTARG";;
    esac
done

create_snapshot "$@"

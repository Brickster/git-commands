#! /usr/bin/env python

import argparse

from commands import upstream
from subprocess import check_output


def get_include_remote_default():
    """Get the default value for including remote info."""

    default = check_output(['git', 'settings', 'get', '-d', 'false', 'git-upstream.include-remote']).splitlines()[0]
    default = str(default).lower() == 'true'
    return default


def main():

    parser = argparse.ArgumentParser(
        prog="git upstream",
        version="git-upstream 0.2.0",
        description="get the current upstream branch",
        epilog="for more detail, use: git help upstream"
    )

    include_remote_group = parser.add_mutually_exclusive_group()

    # -r|--include-remote
    include_remote_group.add_argument(
        "-r",
        "--include-remote",
        help="include the remote name",
        action="store_true",
        dest="include_remote",
        default=get_include_remote_default()
    )

    # -R|--no-include-remote
    include_remote_group.add_argument(
        "-R",
        "--no-include-remote",
        help="don't include the remote name",
        action="store_false",
        dest="include_remote"
    )

    print upstream.upstream(**vars(parser.parse_args()))

if __name__ == "__main__":
    main()
